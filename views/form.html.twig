<!DOCTYPE html>
<html>
<head>
	<title>Ajout de relations</title>
	<script type="text/javascript" src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
	<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

	<script type="text/javascript">
	function deleteHandler(){
		$( ".delete" ).click(function(event) {
			event.preventDefault();
			var id = $(this).attr("linkid");
			$.get( '/delete',{ "id": id }, function(data) {
				$("#tr"+id).remove();
			});
		});
	}
	$(function(){
		$( ".namecomplete" ).autocomplete({
			source: "/getnodes",
			minLength: 3
		});
		$( "#add" ).click(function(event) {
			event.preventDefault();
			$.post( '/getNodeId',{ who: $("#from").val().normalize('NFD').replace(/[\u0300-\u036f]/g, "")}, function (data){
				console.log(data);
				fromId=data.id;
				$.post( '/getNodeId',{ who: $("#to").val().normalize('NFD').replace(/[\u0300-\u036f]/g, "")}, function (data){
					console.log(data);
					toId=data.id;
					$.post( '/add',{ from: fromId, to: toId }, function(data) {
						$("<tr><td>"+data.from+"</td><td>"+data.to+"</td><td><button class=\"btn btn-danger delete\" linkid=\""+data.id+"\" >X</button></td></tr>").prependTo("table > tbody");
						deleteHandler();
						$("#to").val("");
					});
				});
			});


		});

		deleteHandler();
	});	
	</script>
</head>
<body>
	<div class="container-fluid">
		<div class="row">
			<div class="col-md-12 jum">
				<div class="jumbotron">
					<div class="container">
						<h2>
							Ajout de relations
						</h2>
						<p>
							Le graph est visible <a href="/view">ici</a>
						</p>
					</div>
				</div>
			</div>
		</div>
		<div class="row">
			<div class="col-md-6">
			</div>
			<div class="col-md-12">
				<form class="form-horizontal" role="form">
					<div class="form-group">
						<label for="from" class="col-sm-2 control-label">
							Nom du parrain/marraine
						</label>
						<div class="col-sm-10">
							<input class="form-control namecomplete" id="from" name="from" />
						</div>
					</div>
					<div class="form-group">
						<label for="to" class="col-sm-2 control-label">
							Nom du fillot(te)
						</label>
						<div class="col-sm-10">
							<input class="form-control namecomplete" id="to" name="to" />
						</div>
					</div>
					<div class="form-group">
						<div class="col-sm-offset-2 col-sm-10">
							<button class="btn btn-success" id="add" >
								Ajouter
							</button>
						</div>
					</div>
				</form>
				<table class="table">
					<thead>
						<tr>
							<th>
								Parrain/Marraine
							</th>
							<th>
								Fillot(te)
							</th>
							{% if user == "cerichar" %}<th>
								Createur
							</th>{% endif %}
							<th>
								Supprimer
							</th>
						</tr>
					</thead>
					<tbody>
						{% for link in links %}
						<tr id="tr{{link.id}}">
							<td>{{link.from}}</td>
							<td>{{link.to}}</td>
							{% if user == "cerichar" %}<td>{{link.creator}}</td>{% endif %}
							<td>{% if user == link.creator or user == "cerichar" %}
								<button class="btn btn-danger delete" id="add" linkid="{{link.id}}" >
									X
								</button>
								{% endif %}
							</td>
						</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
		</div>
	</div>
</body>
</html>